#!/usr/bin/env sh

CLASS=`basename $0`
ID=${1}
RUNDIR="/run/user/$UID/tchoice"
CHOICEFILE="$RUNDIR/$ID.txt"
[ -d "$RUNDIR" ] || mkdir "$RUNDIR"

[ -z "$WAYLAND_DISPLAY" ] && DOTOOL=xdotool || DOTOOL=ydotool

# closing old windows
oldpids=`$DOTOOL search --class "$CLASS" search --classname "$ID" getwindowpid %@`
for pid in $oldpids
do
  kill $pid
done

# specific options
case `basename $TERMINAL` in
  alacritty)
    class="--class $ID,$CLASS"
    extra='--option window.dimensions.columns=40 --option window.dimensions.lines=10' ;;
  st)
    class="-c $CLASS";;
esac
class=${class:-''}
run=${run:-'-e'}

# run terminal
$TERMINAL $class $extra $run sh -c \
  "printf '`</dev/stdin`' | fzy > $CHOICEFILE"

# print choice
printf `<$CHOICEFILE`
printf '' > $CHOICEFILE
