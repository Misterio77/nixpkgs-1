#!/usr/bin/env sh

ID=$1
RUNDIR="/run/user/$UID/tchoice"
PIDFILE="$RUNDIR/$ID.pid"
CHOICEFILE="$RUNDIR/$ID.txt"

[ -d "$RUNDIR" ] || mkdir "$RUNDIR"
trap 'rm "$PIDFILE" 2>/dev/null && exit 1' SIGHUP SIGINT
[ -e "$PIDFILE" ] && exit 1 || echo $$ > "$PIDFILE"

case `basename $TERMINAL` in
  alacritty) extra='--option window.dimensions.columns=40 --option window.dimensions.lines=10' ;;
  st) set_class='-c' ;;
esac
run=${run:-'-e'}
set_class=${set_class:-'--class'}

$TERMINAL $set_class $0 $extra $run sh -c \
  "printf '`</dev/stdin`' | fzy > $CHOICEFILE"

echo `<$CHOICEFILE`

rm $PIDFILE 2>/dev/null
echo -n "" > $CHOICEFILE


# possible future with xdotool/ydotool
#[ -n "$WAYLAND_DISPLAY" ] && DOTOOL=ydotool
#[ -n "$DISPLAY" ] && DOTOOL=xdotool
